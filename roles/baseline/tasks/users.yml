---

- name: set user account
  tags:
    - users
  become: True
  ansible.builtin.user:
    name: "{{ item.name }}"
    comment: "{{ item.comment }}"
    shell: "{{ item.shell }}"
    home: "{{ item.home }}"
    create_home: "{{ item.create_home }}"
    groups: "{{ item.groups }}"
    system: "{{ item.system }}"
    state: "{{ item.state }}"
  loop: "{{ baseline.users }}"

- name: set user gid
  tags:
    - users
  become: True
  ansible.builtin.group:
    name: "{{ item.name }}"
    gid: "{{ item.gid }}"
  loop: "{{ baseline.users }}"
  when:
    - item.gid is defined
    - item.gid != ''

- name: set user uid
  tags:
    - users
  become: True
  ansible.builtin.user:
    name: "{{ item.name }}"
    uid: "{{ item.uid }}"
  loop: "{{ baseline.users }}"
  when:
    - item.uid is defined
    - item.uid != ''

- name: set user pubkey
  tags:
    - users
  become: True
  ansible.posix.authorized_key:
    user: "{{ item.name }}"
    state: present
    key: "{{ item.authorized_key }}"
  loop: "{{ baseline.users }}"
  when:
     - item.authorized_key != False
